---
import Logo from "../assets/icones/logo.svg";
import BlobDynamic from "./ui/BlobDynamic.astro";
---
<header class="py-5 px-8 lg:py-3 relative z-10 bg-transparent">
    <!-- Logo -->
    <div class="flex justify-between items-center">
        <a href="/" aria-label="Retour à l'accueil">
            <Logo class="w-18 lg:w-20"/>
        </a>
        
        <!-- Navigation desktop -->
        <nav class="hidden lg:flex items-center gap-16" aria-label="Navigation principale">
            <a href="/exposition" class="">L'exposition</a>
            <a href="/artistes" class="">Artistes</a>
            <a href="/visite-virtuelle" class="">Visite 360°</a>
            <a href="/contact" class="">Contact</a>
        </nav>
        
        <!-- Burger menu mobile -->
        <button id="open-menu" class="flex flex-col gap-1.5 mr-4 items-end z-50 relative lg:hidden" aria-label="Ouvrir le menu de navigation" aria-expanded="false" aria-controls="menu-overlay">
            <span class="burger-line burger-line-1 border w-6 transition-all duration-300 ease-in-out"></span>
            <span class="burger-line burger-line-2 border w-6 transition-all duration-300 ease-in-out"></span>
            <span class="burger-line burger-line-3 border w-3 transition-all duration-300 ease-in-out"></span>
        </button>
    </div>
    

    <!-- Menu mobile overlay -->
    <nav id="menu-overlay" class="lg:hidden fixed inset-0 bg-secondary pointer-events-none " aria-hidden="true" aria-label="Menu de navigation mobile">
        <div class="absolute top-[-10%] left-[-20%] md:top-[-20%] md:left-[-15%] w-62.5 md:w-87.5">
            <BlobDynamic variant={1} />
        </div>
        <div class="flex flex-col items-center justify-center gap-16 h-full">
            <ul class="flex flex-col gap-10">
                <li><a href="/exposition" aria-label="Lien vers la page de l'exposition">L'exposition</a></li>
                <li><a href="/artistes" aria-label="Lien vers la page des artistes">Artistes</a></li>
                <li><a href="/visite-virtuelle" aria-label="Lien vers la visite virtuelle à 360 degrés">Visite 360°</a></li>
                <li><a href="/contact" aria-label="Lien vers la page de contact">Contact</a></li>
            </ul>

            <a href="/" aria-label="Retour à l'accueil">
                <Logo class="w-20"/>
            </a>

        </div>
        <div class="absolute bottom-[-8%] right-[-24%] md:bottom-[-18%] md:right-[-15%] w-62.5 md:w-87.5">
            <BlobDynamic variant={1} />
        </div>
    </nav>

</header>

<style>
    /* Optimisation GPU pour le menu */
    #menu-overlay {
        will-change: transform;
        transform: translateX(100%);
        opacity: 0;
        transition: transform 0.5s ease-in-out, all 0.5s ease-in-out;
    }
    
    /* Menu ouvert : slide in depuis le haut */
    #menu-overlay.menu-active {
        transform: translateY(0);
        opacity: 1;
        pointer-events: auto;
    }
   
    /* Animation du burger vers croix */
    #open-menu.menu-open .burger-line-1 {
        transform: rotate(45deg) translateY(7.5px);
        width: 1.5rem; /* w-6 */
    }
    
    #open-menu.menu-open .burger-line-2 {
        opacity: 0;
        transform: translateX(10px);
    }
    
    #open-menu.menu-open .burger-line-3 {
        transform: rotate(-45deg) translateY(-11px) translateX(4px);
        width: 1.5rem; /* w-6 */
    }
    #open-menu.menu-open {
        transform: translateY(0);
    }
</style>

<script>
    document.addEventListener("astro:page-load", () => {
        const openBtn = document.getElementById("open-menu");
        const menu = document.getElementById("menu-overlay");
        const menuLinks = menu?.querySelectorAll('a');

        // Fonction pour gérer le tabindex des liens
        const updateTabIndex = (isActive: boolean) => {
            menuLinks?.forEach(link => {
                if (isActive) {
                    link.removeAttribute('tabindex');
                } else {
                    link.setAttribute('tabindex', '-1');
                }
            });
        };

        // Initialiser avec tabindex="-1" (menu fermé par défaut)
        updateTabIndex(false);

        openBtn?.addEventListener('click', () => {
            const isActive = menu?.classList.toggle('menu-active');
            document.body.classList.toggle('overflow-hidden', isActive);
            menu?.setAttribute('aria-hidden', String(!isActive));
            openBtn?.setAttribute('aria-expanded', String(isActive));
            openBtn?.classList.toggle('menu-open');
            
            // Mettre à jour le tabindex
            updateTabIndex(isActive ?? false);
        });
    });
</script>