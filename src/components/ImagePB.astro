---
interface Props {
  collection: string;    // Nom de la collection
  record: string;        // ID de l'entrée
  file: string;          // Nom du fichier image
  alt: string;           // Description (SEO)
  width?: number;
  height?: number;
  class?: string;        // Pour Tailwind
  loading?: "lazy" | "eager"; // Contrôle du lazy loading
  thumb?: string;        // Taille du thumbnail PocketBase (ex: "400x300", "800x600")
  quality?: number;      // Qualité de l'image (1-100)
  fetchpriority?: "high" | "low" | "auto"; // Priorité de chargement
  aspectRatio?: boolean; // Activer/désactiver le ratio forcé (défaut: true)
  objectFit?: "cover" | "contain" | "fill" | "none"; // Mode d'ajustement de l'image
}

const { 
  collection, 
  record, 
  file, 
  alt, 
  width = 800, 
  height = 600,  
  class: className,
  loading = "lazy",
  thumb,
  quality = 80,
  fetchpriority = "auto",
  aspectRatio = true,
  objectFit = "cover"
} = Astro.props;

// On récupère l'URL de base depuis le .env
const pbUrl = import.meta.env.POCKETBASE_URL;

// Construction de l'URL PocketBase optimisée
// Si thumb est spécifié, on utilise le thumbnail de PocketBase
// Sinon, on charge l'image originale (plus rapide, pas de traitement serveur)
const imageUrl = thumb 
  ? `${pbUrl}/api/files/${collection}/${record}/${file}?thumb=${thumb}`
  : `${pbUrl}/api/files/${collection}/${record}/${file}`;
---

<!-- 
  Utilisation de <img> natif au lieu de <Image> d'Astro
  Cela évite la double transformation (PocketBase + Netlify Image CDN)
  et réduit drastiquement les temps de chargement
-->
<img 
  src={imageUrl}
  alt={alt}
  width={width}
  height={height}
  loading={loading}
  fetchpriority={fetchpriority}
  decoding="async"
  class={`object-${objectFit} ${className}`}
  style={aspectRatio ? `aspect-ratio: ${width} / ${height};` : undefined}
/>