---
//Imports des composants
import Layout from "../../layouts/Layout.astro";
import BlobDynamic from "../../components/ui/BlobDynamic.astro";
import BlobTransition from "../../components/ui/BlobTransition.astro";
import CardArtisteEtOeuvre from "../../components/ui/CardArtisteEtOeuvre.astro";

//Imports des icones
import IconPinterest from "../../assets/icones/pinterest.webp";
import IconInstagram from "../../assets/icones/instagram.webp";
import IconLinkedin from "../../assets/icones/linkedin.webp";
import IconEmail from "../../assets/icones/email.webp";



//Imports des fonctions Backend
import { GetArtistBySlug, getImageUrl, getSuggestedArtistes } from "../../lib/backend";
const slug = Astro.params.id;
const artiste = await GetArtistBySlug(slug);

// Rediriger vers 404 si l'artiste n'existe pas
if (!artiste) {
  return Astro.redirect('/404');
}

// Récupérer 3 artistes de la même promotion avec tri déterministe SEO
const autresArtistes = await getSuggestedArtistes(artiste, 3);

// Données pour ImagePB optimisé
const artisteImageData = artiste.avatar ? {
  collection: artiste.collectionId,
  record: artiste.id,
  file: artiste.avatar
} : null;
---
<Layout title={artiste.name + " | MMI Art 26"} description={"Découvrez le profil de " + artiste.name + ", un talentueux artiste de la promotion MMI Art 26. Explorez son parcours, ses œuvres et son univers créatif."}>
    <main class="overflow-hidden">
        <section class="pt-4">
            <header>
                <div class="w-70 flex mx-auto mb-16">
                    <BlobDynamic 
                      imageUrl={artiste.avatar ? getImageUrl(artiste, artiste.avatar) : null}
                      imageData={artisteImageData}
                      variant={4} 
                    />
                </div>
                <div class="flex flex-col">
                    <h1 class="text-center">{artiste.name}</h1>
                    <span class="uppercase text-right">{artiste.mmi_year}</span>
                </div>
            </header>
            <div class="my-8">
                <p>{artiste.bio}</p>
            </div>
            <div class="flex flex-col gap-12 items-center my-12">
                    <div class="flex gap-8">
                        <a href="#" aria-label="Pinterest de l'artiste">
                            <img class="w-10" src={IconPinterest.src} alt="">
                        </a>
                        <a href="#" aria-label="Instagram de l'artiste">
                            <img class="w-10" src={IconInstagram.src} alt="">
                        </a>
                        <a href="#" aria-label="LinkedIn de l'artiste">
                            <img class="w-10" src={IconLinkedin.src} alt="">
                        </a>
                        <a href="#" aria-label="Email de l'artiste">
                            <img class="w-10" src={IconEmail.src} alt="">
                        </a>
                    </div>
                    <div>
                        <a href="#" class="btn" aria-label="Voir le portfolio de l'artiste">Portfolio</a>
                    </div>
                </div>
            
        </section>

        <BlobTransition position="top" color="#111111" deformStrength={0.3} />

        <section class="black-section">
            <header>
                <h2>Découvrir ses oeuvres</h2>
            </header>
            <ul class="ul-flex">
                {
                    artiste.expand?.oeuvres_id?.map((oeuvre, index) =>  (
                            <li>
                                <CardArtisteEtOeuvre oeuvre={oeuvre} variant={(index % 3) + 1} />
                            </li>
                        )
                    )
                }
            </ul>
            <div class="btn-wrapper">
                <a href="/exposition" class="btn-white">Teaser des oeuvres</a>
            </div>
        </section>

        <BlobTransition position="bottom" color="#111111" deformStrength={0.3} />

        <section>
            <header>
                <h2>Découvrir d'autres artistes</h2>
            </header>
            <ul class="ul-flex">
                {
                    autresArtistes.map((artiste) => (
                    <li>
                        <CardArtisteEtOeuvre artiste={artiste} />
                    </li>
                    ))
                }
            </ul>
            <div class="btn-wrapper">
                <a href="/artistes" class="btn">Voir tous les artistes</a>
            </div>
        </section>
    </main>
</Layout>